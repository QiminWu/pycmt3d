<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Tutorial &mdash; pycmt3d 1.0 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="pycmt3d 1.0 documentation" href="index.html" />
    <link rel="next" title="pycmt3d package" href="pycmt3d.html" />
    <link rel="prev" title="Installation" href="install.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="pycmt3d.html" title="pycmt3d package"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="install.html" title="Installation"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">pycmt3d 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="tutorial">
<h1>Tutorial<a class="headerlink" href="#tutorial" title="Permalink to this headline">¶</a></h1>
<p>To run the inversion, one need to prepare:</p>
<ol class="arabic simple">
<li>Original CMTSource: CMTSource used as starting solution(Ref <a class="reference internal" href="pycmt3d.html#my-source-label"><em>pycmt3d.source module</em></a>).</li>
<li>Data: including observed data, synthetic data, derived synthetic data and associated windows(Ref <a class="reference internal" href="pycmt3d.html#my-window-label"><em>pycmt3d.window module</em></a>)</li>
<li>Inversion shema: how to inversion is done(Ref <a class="reference internal" href="pycmt3d.html#my-config-label"><em>pycmt3d.config module</em></a>)</li>
</ol>
<div class="section" id="cmtsource">
<h2>CMTSource<a class="headerlink" href="#cmtsource" title="Permalink to this headline">¶</a></h2>
<p>Source instance could be loaded as:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">pycmt3d.source</span> <span class="kn">import</span> <span class="n">CMTSource</span>
<span class="n">cmtfile</span> <span class="o">=</span> <span class="s">&quot;path/to/your/cmtfile&quot;</span>
<span class="n">cmtsource</span> <span class="o">=</span> <span class="n">CMTSource</span><span class="o">.</span><span class="n">from_CMTSOLUTION_file</span><span class="p">(</span><span class="n">cmtfile</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="data">
<h2>Data<a class="headerlink" href="#data" title="Permalink to this headline">¶</a></h2>
<p>The pycmt3d pacakge takes two kinds of data.</p>
<ol class="arabic simple">
<li>sac format data</li>
</ol>
<blockquote>
<div><p>Then the setup is exactly as the original fortran version. The pycmt3d needs the outputfile from flexwin which contains observed and synthetic data filename and associated windows. Another thing it needs to know is how many number of deriv synthetic files you want to read. The deriv parameter is listed as [Mrr, Mtt, Mpp, Mrt, Mrp, Mtp, depth, longitude, latitude, time shift, hald duration].
Data could be loaded as:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">pycmt3d.window</span> <span class="kn">import</span> <span class="n">DataContainer</span>
<span class="kn">from</span> <span class="nn">pycmt3d.const</span> <span class="kn">import</span> <span class="n">PAR_LIST</span>
<span class="n">npar</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">flexwin_output</span> <span class="o">=</span> <span class="s">&quot;path/to/your/flexwin_output&quot;</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">DataContainer</span><span class="p">(</span><span class="n">flexwin_output</span><span class="p">,</span> <span class="n">PAR_LIST</span><span class="p">[:</span><span class="n">npar</span><span class="p">])</span>
</pre></div>
</div>
<p>if npar is 6, only the first 6 deriv parameters will be read in, i.e, [Mrr, Mtt, Mpp, Mrt, Mrp, Mtp]. If you want to try different Inversion shema, a larger number of npar is expected. Thus, you can read all necessary deriv synthetic data into the memory and don&#8217;t need to load it again. For example, I usually choose npar to be 9, which contains moment tensor, depth, longitude and latitude.</p>
</div></blockquote>
<ol class="arabic" start="2">
<li><p class="first">ASDF format data</p>
<p>it will be added later on...</p>
</li>
</ol>
</div>
<div class="section" id="inversion-schema">
<h2>Inversion schema<a class="headerlink" href="#inversion-schema" title="Permalink to this headline">¶</a></h2>
<p>Works partially as the INVERSION.PAR file as the fortran version.</p>
<p>One config example is to
1. invert 9 parameters(moment tensor + depth + location), with location perturbation 0.03 degree, depth perturbation 3.0km and moment perturbation 2.0e23.
2. Weighting will be applied and the no weighting function specified(default weighting function used).
3. Station correction will be applied
4. Constrain includes zero trace but no double couple.
5. Damping set to 0(no damping)
6. Bootstrap will not be used.</p>
<p>Code example as following:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">pycmt3d.config</span> <span class="kn">import</span> <span class="n">Config</span>
<span class="n">npar</span> <span class="o">=</span> <span class="mi">9</span>   <span class="c"># 9 paramter inversion</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">npar</span><span class="p">,</span> <span class="n">dlocation</span><span class="o">=</span><span class="mf">0.03</span><span class="p">,</span> <span class="n">ddepth</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">dmoment</span><span class="o">=</span><span class="mf">2.0e+23</span><span class="p">,</span>
    <span class="n">weight_data</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">weight_function</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">normalize_window</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
    <span class="n">norm_mode</span><span class="o">=</span><span class="s">&quot;data_and_synt&quot;</span><span class="p">,</span> <span class="n">station_correction</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">zero_trace</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">double_couple</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">lamda_damping</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
    <span class="n">bootstrap</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">bootstrap_repeat</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
<ul>
<li><dl class="first docutils">
<dt>Bootstrap</dt>
<dd><p class="first last">If you want to do some statistic analysis on the inversion, you can turn the bootstrap analysis by turning the bootstrap on by setting &#8220;boostrap = True&#8221; in the config. It will provide the mean value and the standard deviation.</p>
</dd>
</dl>
</li>
<li><dl class="first docutils">
<dt>Window energy normalization</dt>
<dd><p class="first last">If you want the measurement from each window normalized by it&#8217;s energy, you can set the flag &#8220;normalize_window = True&#8221; in config. There are two normalization mode you can choose.
1. norm_mode=&#8221;data_and_synt&#8221;
2. norm_mode=&#8221;data_only&#8221;</p>
</dd>
</dl>
</li>
</ul>
</div>
<div class="section" id="source-inversion">
<h2>Source Inversion<a class="headerlink" href="#source-inversion" title="Permalink to this headline">¶</a></h2>
<p>After get the CMTSource, Data and Inversion scheme ready, the source inversion can then be conducted:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">pycmt3d.cmt3d</span> <span class="kn">import</span> <span class="n">Cmt3D</span>
<span class="n">srcinv</span> <span class="o">=</span> <span class="n">Cmt3D</span><span class="p">(</span><span class="n">cmtsource</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>
<span class="n">srcinv</span><span class="o">.</span><span class="n">source_inversion</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="workflow-example">
<h2>Workflow Example<a class="headerlink" href="#workflow-example" title="Permalink to this headline">¶</a></h2>
<p>The complete workflow example is shown below:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">pycmt3d.source</span> <span class="kn">import</span> <span class="n">CMTSource</span>
<span class="kn">from</span> <span class="nn">pycmt3d.window</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">pycmt3d.config</span> <span class="kn">import</span> <span class="n">Config</span>
<span class="kn">from</span> <span class="nn">pycmt3d.cmt3d</span> <span class="kn">import</span> <span class="n">Cmt3D</span>

<span class="c"># load cmtsource</span>
<span class="n">cmtfile</span> <span class="o">=</span> <span class="s">&quot;path/to/your/cmtfile&quot;</span>
<span class="n">cmtsource</span> <span class="o">=</span> <span class="n">CMTSource</span><span class="o">.</span><span class="n">from_CMTSOLUTION_file</span><span class="p">(</span><span class="n">cmtfile</span><span class="p">)</span>

<span class="c"># load data and window from flexwin output file</span>
<span class="kn">from</span> <span class="nn">const</span> <span class="kn">import</span> <span class="n">PAR_LIST</span>
<span class="n">data_npar</span> <span class="o">=</span> <span class="mi">9</span> <span class="c"># read 9 deriv synthetic</span>
<span class="n">flexwin_output</span> <span class="o">=</span> <span class="s">&quot;path/to/your/flexwin_output&quot;</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">DataContainer</span><span class="p">(</span><span class="n">flexwin_output</span><span class="p">,</span> <span class="n">PAR_LIST</span><span class="p">[:</span><span class="n">data_npar</span><span class="p">])</span>

<span class="c"># inversion shema</span>
<span class="n">npar</span> <span class="o">=</span> <span class="mi">9</span>   <span class="c"># 9 paramter inversion</span>
<span class="n">config</span> <span class="o">=</span> <span class="n">Config</span><span class="p">(</span><span class="n">npar</span><span class="p">,</span> <span class="n">dlocation</span><span class="o">=</span><span class="mf">0.03</span><span class="p">,</span> <span class="n">ddepth</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">dmoment</span><span class="o">=</span><span class="mf">2.0e+23</span><span class="p">,</span>
    <span class="n">weight_data</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">weight_function</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">station_correction</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
    <span class="n">zero_trace</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">double_couple</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">lamda_damping</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span>
    <span class="n">bootstrap</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="c"># source inversion</span>
<span class="n">srcinv</span> <span class="o">=</span> <span class="n">Cmt3D</span><span class="p">(</span><span class="n">cmtsource</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">config</span><span class="p">)</span>
<span class="n">srcinv</span><span class="o">.</span><span class="n">source_inversion</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Tutorial</a><ul>
<li><a class="reference internal" href="#cmtsource">CMTSource</a></li>
<li><a class="reference internal" href="#data">Data</a></li>
<li><a class="reference internal" href="#inversion-schema">Inversion schema</a></li>
<li><a class="reference internal" href="#source-inversion">Source Inversion</a></li>
<li><a class="reference internal" href="#workflow-example">Workflow Example</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="install.html"
                        title="previous chapter">Installation</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="pycmt3d.html"
                        title="next chapter">pycmt3d package</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/tutorial.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="pycmt3d.html" title="pycmt3d package"
             >next</a> |</li>
        <li class="right" >
          <a href="install.html" title="Installation"
             >previous</a> |</li>
        <li><a href="index.html">pycmt3d 1.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2015, Wenjie Lei and Xin Song.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.3.
    </div>
  </body>
</html>